<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VerifAI - Official Report</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        /* Base Theme */
        body { background: #0f172a; min-height: 100vh; color: #e2e8f0; font-family: 'Segoe UI', sans-serif; }
        
        /* Glassmorphism */
        .glass-panel { 
            background: rgba(30, 41, 59, 0.7); 
            backdrop-filter: blur(20px); 
            border: 1px solid rgba(255, 255, 255, 0.1); 
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }

        /* THE STAMP EFFECT */
        .stamp-box {
            position: relative;
            display: inline-block;
            padding: 0.5rem 2rem;
            text-transform: uppercase;
            font-weight: 900;
            font-size: 2rem;
            border: 5px solid;
            border-radius: 10px;
            transform: rotate(-12deg);
            opacity: 0;
            animation: stampIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
            animation-delay: 0.2s;
            letter-spacing: 0.1em;
            mask-image: url('https://s3-us-west-2.amazonaws.com/s.cdpn.io/8399/grunge.png');
            mask-size: 940px 600px;
            mix-blend-mode: hard-light;
        }

        /* Stamp Variations */
        .stamp-verified {
            color: #22c55e;
            border-color: #22c55e;
            text-shadow: 0 0 15px rgba(34, 197, 94, 0.5);
        }
        .stamp-false {
            color: #ef4444;
            border-color: #ef4444;
            text-shadow: 0 0 15px rgba(239, 68, 68, 0.5);
        }
        .stamp-unverified {
            color: #f59e0b;
            border-color: #f59e0b;
            border-style: double;
            border-width: 8px;
            text-shadow: 0 0 15px rgba(245, 158, 11, 0.5);
        }

        @keyframes stampIn {
            0% { transform: scale(3) rotate(0deg); opacity: 0; }
            100% { transform: scale(1) rotate(-12deg); opacity: 0.9; }
        }

        .report-card {
            background: #1e293b;
            border-top: 4px solid #3b82f6;
            background-image: radial-gradient(#334155 1px, transparent 1px);
            background-size: 20px 20px;
        }

        #analyzeBtn { z-index: 50; cursor: pointer; }
    </style>
</head>
<body class="antialiased">

    <nav class="flex items-center justify-between px-6 py-4 border-b border-slate-800 bg-slate-900/80 sticky top-0 z-50 backdrop-blur">
        <div class="flex items-center gap-3">
            <div class="bg-blue-600 w-8 h-8 rounded flex items-center justify-center shadow-lg shadow-blue-500/30">
                <i class="fas fa-check text-white text-sm"></i>
            </div>
            <span class="text-xl font-bold tracking-tight text-white">Verif<span class="text-blue-500">AI</span></span>
        </div>
        
        <a href="https://buymeacoffee.com/trustscore" target="_blank" class="flex items-center gap-2 px-3 py-1.5 rounded-full bg-yellow-500/10 text-yellow-500 hover:bg-yellow-500/20 transition-all border border-yellow-500/20 group">
            <i class="fas fa-mug-hot text-xs group-hover:animate-bounce"></i> 
            <span class="text-xs font-bold tracking-wide">Buy Me a Coffee</span>
        </a>
    </nav>

    <main class="max-w-xl mx-auto px-4 pt-8 pb-20">
        
        <div class="text-center mb-8">
            <h1 class="text-3xl font-bold text-white mb-2">Fact-Check Any Message</h1>
            <p class="text-slate-400 text-sm">Paste a forwarded WhatsApp message below to audit it for lies, viral patterns, and manipulation.</p>
        </div>

        <div class="glass-panel rounded-2xl p-1 relative z-20 shadow-2xl">
            <div class="bg-slate-900 rounded-xl p-4">
                <textarea id="inputText" 
                    class="w-full h-32 bg-transparent text-lg text-white placeholder-slate-600 focus:outline-none resize-none font-sans" 
                    placeholder="Paste text here..."></textarea>
                
                <div class="flex justify-end pt-4 border-t border-slate-800">
                    <button onclick="analyze()" id="analyzeBtn" 
                        class="bg-blue-600 hover:bg-blue-500 text-white font-bold py-3 px-8 rounded-lg shadow-lg shadow-blue-900/50 transition-all active:scale-95 flex items-center gap-2">
                        <span>Analyze Truth</span> <i class="fas fa-search"></i>
                    </button>
                </div>
            </div>
        </div>

        <div id="results" class="hidden mt-8 fade-in relative z-10">
            
            <div class="report-card rounded-xl shadow-2xl overflow-hidden relative">
                
                <div class="bg-slate-800/50 px-4 py-2 flex justify-between items-center border-b border-slate-700">
                    <span class="text-[10px] text-slate-400 font-mono tracking-widest uppercase">VerifAI Audit #<span id="randomId">8293</span></span>
                    <span class="text-[10px] text-slate-400 font-mono" id="dateDisplay">DATE</span>
                </div>

                <div class="p-8 text-center relative">
                    <div id="stampContainer" class="mb-6 h-24 flex items-center justify-center relative z-20">
                    </div>

                    <h2 id="verdictSubtitle" class="text-slate-400 text-xs font-bold uppercase tracking-[0.2em] mb-4">CLAIM ANALYSIS</h2>
                    
                    <div class="flex items-center justify-center gap-8 mb-6">
                        <div class="text-center">
                            <div class="text-[10px] text-slate-500 uppercase font-bold">Trust Score</div>
                            <div id="scoreVal" class="text-4xl font-black text-white">--</div>
                        </div>
                        <div class="w-px h-10 bg-slate-700"></div>
                        <div class="text-center">
                            <div class="text-[10px] text-slate-500 uppercase font-bold">Risk Level</div>
                            <div id="riskVal" class="text-lg font-bold text-white mt-1">--</div>
                        </div>
                    </div>

                    <div class="bg-slate-900/50 rounded-lg p-4 text-left border border-slate-700/50">
                        <p id="explanation" class="text-slate-300 text-sm leading-relaxed"></p>
                    </div>

                    <div class="mt-4 text-left">
                        <ul id="flagsList" class="space-y-2"></ul>
                    </div>
                </div>

                <div class="bg-slate-900 px-6 py-4 border-t border-slate-800">
                    <div class="text-[10px] text-slate-500 uppercase font-bold mb-2">Internal Verification Match</div>
                    <ul id="sourcesList" class="space-y-1"></ul>
                </div>
            </div>

            <div class="grid grid-cols-4 gap-3 mt-4">
                <button onclick="shareResult()" class="col-span-3 bg-green-600 hover:bg-green-500 text-white font-bold py-4 rounded-xl shadow-lg shadow-green-900/20 active:scale-95 flex items-center justify-center gap-2">
                    <i class="fab fa-whatsapp text-2xl"></i>
                    <div class="text-left leading-tight">
                        <div class="text-xs opacity-80 font-normal">Share Report</div>
                        <div class="text-sm">Send to WhatsApp</div>
                    </div>
                </button>
                <button onclick="copyReport()" class="col-span-1 bg-slate-700 hover:bg-slate-600 text-white font-bold rounded-xl shadow-lg active:scale-95">
                    <i class="fas fa-copy"></i>
                </button>
            </div>
            
            <p class="text-center text-slate-600 text-xs mt-6">
                VerifAI is an offline credibility assessment tool. <br>Always verify important news with official sources.
            </p>

        </div>
    </main>

    <script>
        // Set Date
        const now = new Date();
        document.getElementById("dateDisplay").innerText = now.toLocaleDateString('en-GB', { day: 'numeric', month: 'short', year: 'numeric' }).toUpperCase();
        document.getElementById("randomId").innerText = Math.floor(1000 + Math.random() * 9000);

        let currentResult = {};
        let currentInput = "";

        async function analyze() {
            const text = document.getElementById("inputText").value;
            currentInput = text.length > 50 ? text.substring(0, 50) + "..." : text;
            const btn = document.getElementById("analyzeBtn");
            
            if (!text) return alert("Please enter text.");
            
            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-circle-notch fa-spin"></i> Audit Running...';
            document.getElementById("results").classList.add("hidden");
            
            const formData = new FormData();
            formData.append("text", text);

            try {
                const res = await fetch("/check", { method: "POST", body: formData });
                const data = await res.json();
                currentResult = data;
                
                document.getElementById("results").classList.remove("hidden");
                
                // STAMP LOGIC
                const verdict = data.verdict || "UNVERIFIED";
                let stampClass = "stamp-unverified";
                if(verdict === "Verified" || verdict === "History Match") stampClass = "stamp-verified";
                if(verdict === "False") stampClass = "stamp-false";

                const stampContainer = document.getElementById("stampContainer");
                stampContainer.innerHTML = '';
                void stampContainer.offsetWidth; 
                stampContainer.innerHTML = `<div class="stamp-box ${stampClass}">${verdict}</div>`;

                document.getElementById("verdictSubtitle").innerText = `CLAIM TYPE: ${data.claim_type || "UNKNOWN"}`;
                
                const scoreEl = document.getElementById("scoreVal");
                scoreEl.innerText = data.trust_score;
                if(data.trust_score > 60) scoreEl.className = "text-4xl font-black text-green-400";
                else if(data.trust_score < 40) scoreEl.className = "text-4xl font-black text-red-400";
                else scoreEl.className = "text-4xl font-black text-yellow-400";

                document.getElementById("riskVal").innerText = data.risk_level || "Medium";
                document.getElementById("riskVal").className = `text-lg font-bold ${data.risk_level === 'High' ? 'text-red-400' : 'text-slate-200'}`;

                document.getElementById("explanation").innerText = data.explanation || "No explanation provided.";

                const flags = document.getElementById("flagsList");
                flags.innerHTML = "";
                if(data.flags && data.flags.length) {
                    data.flags.forEach(f => flags.innerHTML += `<li class="flex items-start gap-2 text-xs text-red-300 bg-red-900/20 p-2 rounded border border-red-900/30"><i class="fas fa-exclamation-triangle mt-0.5"></i> <span>${f}</span></li>`);
                } else {
                    flags.innerHTML = "<li class='text-slate-500 text-xs italic'>No specific risk flags detected.</li>";
                }

                const sources = document.getElementById("sourcesList");
                sources.innerHTML = "";
                if(data.estimated_sources && data.estimated_sources.length) {
                    data.estimated_sources.forEach(s => sources.innerHTML += `<li class="flex items-center gap-2 text-xs text-green-400"><i class="fas fa-database"></i> <span>${s}</span></li>`);
                } else {
                    sources.innerHTML = "<li class='text-slate-600 text-xs italic'>No matching sources in offline database.</li>";
                }

            } catch (e) {
                console.error(e);
                alert("Server error. Please ensure backend is running.");
            } finally {
                btn.disabled = false;
                btn.innerHTML = '<span>Analyze Truth</span> <i class="fas fa-search"></i>';
            }
        }

        function shareResult() {
            if (!currentResult.verdict) return;

            const verdictIcon = currentResult.verdict === "Verified" ? "âœ…" : currentResult.verdict === "False" ? "âŒ" : "âš ï¸";

            const shareText = `*VerifAI Security Report* ðŸ›¡ï¸\n\n` +
                `ðŸ“ *Claim:* "${currentInput}"\n` +
                `${verdictIcon} *Verdict:* ${currentResult.verdict.toUpperCase()}\n` +
                `ðŸ“Š *Score:* ${currentResult.trust_score}/100\n` +
                `ðŸš¨ *Risk:* ${currentResult.risk_level}\n\n` +
                `*Verify your messages here:* ðŸ‘‡\n` +
                `https://trust-score.onrender.com`;

            if (navigator.share) {
                navigator.share({ title: 'VerifAI Report', text: shareText }).catch(console.error);
            } else {
                window.open(`https://wa.me/?text=${encodeURIComponent(shareText)}`, '_blank');
            }
        }

        function copyReport() {
             if (!currentResult.verdict) return;
             const verdictIcon = currentResult.verdict === "Verified" ? "âœ…" : currentResult.verdict === "False" ? "âŒ" : "âš ï¸";
             const shareText = `*VerifAI Security Report* ðŸ›¡ï¸\n\nðŸ“ *Claim:* "${currentInput}"\n${verdictIcon} *Verdict:* ${currentResult.verdict.toUpperCase()}\nðŸ“Š *Score:* ${currentResult.trust_score}/100\nðŸš¨ *Risk:* ${currentResult.risk_level}\n\n*Verify here:* https://trust-score.onrender.com`;
             
             navigator.clipboard.writeText(shareText).then(() => alert("Report copied!"));
        }
    </script>
</body>
</html>
